{{ define "main" }}
<div style="position: relative; min-height: 100vh;">
    <!-- Search Bar Top Right -->
    <div style="position: absolute; top: 20px; right: 40px; z-index: 10;">
        <input id="searchInput" type="text" placeholder="Search..." style="width: 160px; padding: 6px 10px; border-radius: 4px; border: 1px solid #ccc; font-size: 14px;">
        <div id="searchResults" style="position: absolute; right: 0; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-radius: 4px; width: 240px; max-height: 250px; overflow-y: auto; margin-top: 2px;"></div>
    </div>

    <div style="display: flex; flex-direction: column; align-items: center; gap: 20px; padding: 20px;">
        <h1 style="color: #2c3e50; font-size: 32px;">Task Management</h1>
        
        <!-- JSON data for search -->
        {{ $allPages := .Site.RegularPages }} 
        {{ $titles := slice }}
        {{ range $allPages }}
          {{ $titles = $titles | append (dict "title" .Title "url" .RelPermalink) }}
        {{ end }}
        <div id="searchData" style="display:none;">{{ $titles | jsonify }}</div>

        <!-- Navigation Buttons -->
        <div style="display: flex; gap: 20px; margin: 20px 0;">
            <a href="/teachers" style="background-color: #3498db; color: white; padding: 15px 30px; text-decoration: none; border-radius: 5px;">Teachers List</a>
            <a href="/students" style="background-color: #e74c3c; color: white; padding: 15px 30px; text-decoration: none; border-radius: 5px;">Students List</a>
            <a href="/tasks" style="background-color: #2ecc71; color: white; padding: 15px 30px; text-decoration: none; border-radius: 5px;">Tasks List</a>
        </div>

        <!-- Recently Added Tasks -->
        <div style="width: 100%; max-width: 800px; background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h2 style="color: #2c3e50; margin-bottom: 20px;">Recently Added Tasks</h2>
            {{ $tasks := where .Site.RegularPages "Section" "tasks" }}
            {{ $sortedTasks := sort $tasks ".Date" "desc" }}
            {{ $recentTasks := first 5 $sortedTasks }}
            {{ if $recentTasks }}
                <div style="display: flex; flex-direction: column; gap: 15px;">
                {{ range $recentTasks }}
                    <div style="padding: 15px; background-color: #f8f9fa; border-radius: 5px;">
                        <h3 style="color: #34495e; margin: 0;">
                            <a href="{{ .RelPermalink }}" style="color: #34495e; text-decoration: none; hover: underline;">{{ .Title }}</a>
                        </h3>
                        <p style="color: #666; margin: 5px 0;">Added: {{ .Date.Format "January 2, 2006" }}</p>
                        {{ with .Description }}
                            <p style="color: #666; margin: 5px 0;">{{ . }}</p>
                        {{ end }}
                    </div>
                {{ end }}
                </div>
            {{ else }}
                <p style="color: #666;">No tasks available yet.</p>
            {{ end }}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Get and parse the JSON from the hidden div
    const titles = JSON.parse(document.getElementById('searchData').textContent);
    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');

    function renderResults(results) {
        if (!searchInput.value.trim()) {
            searchResults.innerHTML = '';
            return;
        }
        if (results.length === 0) {
            searchResults.innerHTML = '<p style="color:#888; padding:8px;">No results found.</p>';
            return;
        }
        searchResults.innerHTML = results.map(item => `
            <div style="padding: 8px 12px; background: #f8f9fa; border-radius: 3px; margin-bottom: 4px;">
                <a href="${item.url}" style="font-weight: bold; color: #34495e; text-decoration: none;">${item.title}</a>
            </div>
        `).join('');
    }

    searchInput.addEventListener('input', function() {
        const query = this.value.trim().toLowerCase();
        if (!query) {
            searchResults.innerHTML = '';
            return;
        }
        const filtered = titles.filter(item => item.title && item.title.toLowerCase().includes(query));
        renderResults(filtered);
    });

    // Hide results when clicking outside
    document.addEventListener('click', function(e) {
        if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
            searchResults.innerHTML = '';
        }
    });
});
</script>
{{ end }}
